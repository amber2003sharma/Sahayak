<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Location Tracker with Heatmap, Danger Zones, and Roads</title>
    <style>
        #map {
            height: 100vh; /* Full viewport height */
            width: 100%; /* Full width */
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
    </style>
</head>

<body>
    <script src="new.js"></script>
    <div id="info">
        <h3>Danger Zones</h3>
        <ul id="danger-zones"></ul>
        <h3>Police Stations</h3>
        <ul id="police-stations"></ul>
    </div>
    <div id="map"></div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1I25XIK2n3pUAXI9IYHHSpDaAPNp1iUo&callback=initMap&callback=initMap&libraries=visualization" async defer></script>
    <script>
        let map;
        let marker;
        let infoWindow;
        let heatmap;
        let heatmapData = [];
        let dangerZonesData = [
            [
            { lat: 26.2130, lng: 78.1760 }, // Hotspot 1
    { lat: 26.2155, lng: 78.1795 }, // Hotspot 2
    { lat: 26.2125, lng: 78.1800 } ,
    { lat: 26.2145, lng: 78.1772 },
        { lat: 26.2150, lng: 78.1785 },
        { lat: 26.2140, lng: 78.1790 },
        { lat: 26.2135, lng: 78.1780 } 

             // Close the polygon
            ],
            // Add more danger zones if needed
        ];
        let policeStationsData = [
            { lat: 26.2182, lng: 78.1770 }, // Example police station coordinates
            { lat: 26.2150, lng: 78.1885 },
            { lat: 26.2115, lng: 78.1735},
            { lat: 26.2223, lng: 78.1698 },
            // Add more police stations if needed
        ];

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 30,
                center: { lat: 26.2070, lng: 78.1825 } // Center of the area
            });

            infoWindow = new google.maps.InfoWindow();
            
            heatmap = new google.maps.visualization.HeatmapLayer({
                data: heatmapData,
                map: map
            });

            // Draw danger zones as polygons
            dangerZonesData.forEach(zone => {
                new google.maps.Polygon({
                    paths: zone,
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,
                    map: map
                });
            });

            // Display danger zone coordinates in the list
            dangerZonesData.forEach((zone, index) => {
                document.getElementById('danger-zones').innerHTML += `<li>Zone ${index + 1}: ${zone.map(coord => `(${coord.lat}, ${coord.lng})`).join(', ')}</li>`;
            });

            // Mark police stations and display their coordinates
            policeStationsData.forEach((station, index) => {
                const stationMarker = new google.maps.Marker({
                    position: station,
                    map: map,
                    title: `Police Station ${index + 1}`,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 5,
                        fillColor: '#FFFF00', // Yellow color
                        fillOpacity: 1,
                        strokeColor: '#FFFF00',
                        strokeWeight: 1
                    }
                });

                // Display police station coordinates in the list
                document.getElementById('police-stations').innerHTML += `<li>Police Station ${index + 1}: (${station.lat}, ${station.lng})</li>`;
            });

            const trafficLayer = new google.maps.TrafficLayer();
            trafficLayer.setMap(map);

            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    position => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };

                        console.log(`Live Coordinates: Latitude: ${pos.lat}, Longitude: ${pos.lng}`);

                        if (!marker) {
                            marker = new google.maps.Marker({
                                position: pos,
                                map: map,
                                title: 'Your Location'
                            });
                        } else {
                            marker.setPosition(pos);
                        }

                        map.setCenter(pos);

                        infoWindow.setPosition(pos);
                        infoWindow.setContent('You are here');
                        infoWindow.open(map);

                        heatmapData.push(new google.maps.LatLng(pos.lat, pos.lng));
                        heatmap.setData(heatmapData);
                    },
                    error => {
                        handleLocationError(true, map.getCenter());
                    },
                    {
                        enableHighAccuracy: true,
                        maximumAge: 30000,
                        timeout: 27000
                    }
                );
            } else {
                handleLocationError(false, map.getCenter());
            }

            displayRoutes();
        }

        function displayRoutes() {
            const request = {
                origin: { lat: 30.7046, lng: 76.7179 },
                destination: { lat: 30.7012, lng: 76.6331 },
                travelMode: 'DRIVING'
            };

            const directionsService = new google.maps.DirectionsService();
            const directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);

            directionsService.route(request, (result, status) => {
                if (status === 'OK') {
                    directionsRenderer.setDirections(result);
                } else {
                    console.error('Directions request failed due to ' + status);
                }
            });
        }

        function handleLocationError(browserHasGeolocation, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation
                ? 'Error: The Geolocation service failed.'
                : 'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }
    </script>
</body>
</html>
